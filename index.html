<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Super Hara World - Inimigos</title>
  <style>
    body {
      margin: 0;
      background: #111;
      font-family: sans-serif;
      color: white;
      text-align: center;
    }
    canvas {
      background: #87CEEB;
      border: 2px solid black;
      display: block;
      margin: 0 auto;
    }
  </style>
</head>
<body>

<canvas id="game" width="800" height="400"></canvas>

<script>
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');

  const player = {
    x: 100,
    y: 300,
    width: 64,
    height: 64,
    dy: 0,
    vx: 0,
    onGround: false,
    jumpCount: 0,
    alive: true
  };

  const gravity = 0.8;
  const jumpStrength = -14;
  const speed = 4;
  let keys = {};
  let cameraX = 0;

  const floor = {
    x: 0,
    y: 350,
    width: 5000,
    height: 50,
    color: 'green'
  };

  const platforms = [
    { x: 300, y: 280, width: 100, height: 10 },
    { x: 600, y: 250, width: 120, height: 10 },
    { x: 900, y: 200, width: 100, height: 10 },
    { x: 1300, y: 260, width: 150, height: 10 }
  ];

  const enemies = [
    { x: 500, y: 310, width: 40, height: 40, vx: 1, dead: false },
    { x: 1150, y: 310, width: 40, height: 40, vx: -1, dead: false }
  ];

  const img = new Image();
  img.src = "sprite_personagem.png";

  document.addEventListener('keydown', e => {
    keys[e.key] = true;
    if (e.key === " " && player.jumpCount < 2 && player.alive) {
      player.dy = jumpStrength;
      player.jumpCount++;
    }
  });

  document.addEventListener('keyup', e => keys[e.key] = false);

  function update() {
    if (!player.alive) return;

    player.vx = 0;
    if (keys['ArrowRight']) player.vx = speed;
    if (keys['ArrowLeft']) player.vx = -speed;

    player.x += player.vx;
    player.dy += gravity;
    player.y += player.dy;
    player.onGround = false;

    if (player.y + player.height >= floor.y) {
      player.y = floor.y - player.height;
      player.dy = 0;
      player.onGround = true;
      player.jumpCount = 0;
    }

    for (const p of platforms) {
      if (player.y + player.height <= p.y + 10 &&
          player.y + player.height + player.dy >= p.y &&
          player.x + player.width > p.x &&
          player.x < p.x + p.width) {
        player.y = p.y - player.height;
        player.dy = 0;
        player.onGround = true;
        player.jumpCount = 0;
      }
    }

    for (const e of enemies) {
      if (e.dead) continue;
      e.x += e.vx;
      if (e.x <= 400 || e.x >= 1400) e.vx *= -1;

      // colis√£o com player
      const hit = player.x < e.x + e.width &&
                  player.x + player.width > e.x &&
                  player.y < e.y + e.height &&
                  player.y + player.height > e.y;

      if (hit) {
        if (player.dy > 0 && player.y + player.height - e.y < 20) {
          e.dead = true;
          player.dy = jumpStrength / 1.5;
        } else {
          player.alive = false;
        }
      }
    }

    if (player.x < 0) player.x = 0;
    if (player.x + player.width > floor.width) player.x = floor.width - player.width;

    cameraX = player.x - canvas.width / 2;
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.save();
    ctx.translate(-cameraX, 0);

    ctx.fillStyle = floor.color;
    ctx.fillRect(floor.x, floor.y, floor.width, floor.height);

    ctx.fillStyle = 'gray';
    platforms.forEach(p => {
      ctx.fillRect(p.x, p.y, p.width, p.height);
    });

    ctx.drawImage(img, player.x, player.y, player.width, player.height);

    enemies.forEach(e => {
      if (!e.dead) {
        ctx.fillStyle = "purple";
        ctx.fillRect(e.x, e.y, e.width, e.height);
      }
    });

    ctx.restore();
  }

  function loop() {
    update();
    draw();
    requestAnimationFrame(loop);
  }

  img.onload = loop;
</script>

</body>
</html>
